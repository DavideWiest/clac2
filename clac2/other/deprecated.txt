

|> map (fun lines -> determineDependencies dir lines, lines)
        |> bind (fun (dependencies, lines) -> 
            dependencies
            |> Array.map tryReadFileIntermedExc
            |> combineResultsToArray
            |> bind (Array.map (loadAllFilesInner stdCtx dir) >> combineResultsToArray)
            |> map (Array.map (fun (deps, lines) -> extractCustomDefinitions lines))
            |> map (
                Array.fold (fun defCtxAcc (customTypes, customAssignments) -> 
                    { 
                        types = Array.append customTypes defCtxAcc.types
                        functions = Array.append customAssignments defCtxAcc.functions
                    }
                ) stdCtx.defCtx
            )
            |> map (fun newDefCtx -> newDefCtx, lines)


            